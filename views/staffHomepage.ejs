<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RestoConnect - Staff Home</title>
    <link rel="stylesheet" href="/css/staffHomepage.css" />
</head>
<body>
    <nav class="nav-header">
        <div class="nav-container">
            <div class="logo">RestoConnect</div>
            <div class="nav-links">
                <a href="/staff/Dashboard" class="nav-link">Dashboard</a>
                <a href="/logout" class="nav-link">Logout</a>
            </div>
        </div>
    </nav>

    <div class="main-content">
        <div class="container">
            <h1 class="title">Staff Tasks Management</h1>
            <div class="task-box">
                <h2>Today's Tasks</h2>
                <ul id="task-list">
                    <% tasks.forEach(task => { %>
                        <li id="task-<%= task.id %>">
                            <span class="task-text"><%= task.name %></span>
                            <form action="/staff/HomePage/tasks/delete/<%= task.id %>" method="POST" style="display:inline;">
                                <button type="submit" class="delete-btn" aria-label="Delete Task" title="Delete Task">üóëÔ∏è</button>
                            </form>
                        </li>
                    <% }); %>
                </ul>
                <button class="add-btn" id="add-task-btn">+ Add Task</button>
            </div>

            <!-- New Section: Reservations Needing Allocation -->
            <div class="reservation-allocation-box">
                <h2>Reservations Needing Allocation</h2>
                <% if (reservationsNeedingAllocation.length === 0) { %>
                    <p>No reservations need table allocation.</p>
                <% } else { %>
                    <ul>
                        <% reservationsNeedingAllocation.forEach(reservation => { %>
                            <li>
                                <strong><%= reservation.name %></strong> - Guests: <%= reservation.guests %> - Date: <%= reservation.date %> - Time: <%= reservation.time %>
                                <form action="/staff/Dashboard/allocate-table" method="POST" style="display:inline;">
                                    <input type="hidden" name="reservationId" value="<%= reservation.id %>" />
                                    <select name="tableNumber" required>
                                        <option value="" disabled selected>Select Table</option>
                                        <% availableTables.forEach(table => { %>
                                            <% if (table.seats >= reservation.guests) { %>
                                                <option value="<%= table.number %>">Table <%= table.number %> (Seats: <%= table.seats %>)</option>
                                            <% } %>
                                        <% }); %>
                                    </select>
                                    <button type="submit" class="allocate-btn" title="Allocate Selected Table">Assign Table</button>
                                </form>
                            </li>
                        <% }); %>
                    </ul>
                <% } %>
            </div>

            <!-- New Section: Allocated Tables -->
            <div class="allocated-tables-box">
                <h2>Allocated Tables</h2>
                <% if (allocatedTables.length === 0) { %>
                    <p>No tables allocated yet.</p>
                <% } else { %>
                    <ul>
                        <% allocatedTables.forEach(allocation => { %>
                            <li>
                                Table <%= allocation.table %> - Reserved by: <strong><%= allocation.reservationName %></strong>
                                <form action="/staff/Dashboard/remove-reservation/delete/<%= allocation.reservationId %>" method="POST" style="display:inline;">
                                    <button type="submit" class="delete-btn" title="Delete Reservation and Free Table">üóëÔ∏è</button>
                                </form>
                            </li>
                        <% }); %>
                    </ul>
                <% } %>
            </div>
        </div>
    </div>

    <div id="task_taker" class="dispaly_none">
        <form action="/staff/HomePage/tasks" method="post" id="add_task_form">
            <input type="text" name="name" />
            <button type="submit" onclick="add_task()">add</button>
        </form>
    </div>

    <script src="/js/staffHomepage.js"></script>
</body>
</html>
